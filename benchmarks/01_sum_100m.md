# Benchmark: Sum of 0 to 100 Million

This benchmark measures a simple loop summing integers from 0 to 100,000,000.

## Results

| Language | Optimization | Execution Time | vs Python |
|----------|-------------|----------------|-----------|
| Python | - | 6.556s | 1x |
| **DynLex** | O0 | 0.196s | **33x faster** |
| C++ | O0 | 0.186s | 35x faster |
| **DynLex** | O3 | 0.001s | **6556x faster** |
| C++ | O3 | 0.001s | 6556x faster |

All outputs: `4999999950000000` (correct)

### Compilation Times

| Compiler | Time |
|----------|------|
| DynLex | ~50ms |
| g++ | ~35ms |

## Notes

With -O3 optimization, both DynLex and C++ compute the result at compile time via LLVM constant folding, making execution essentially instant.

Without optimization, DynLex is ~5% slower than C++ due to function call overhead for the `set var to val` pattern (not yet inlined without optimization).

## Source Code

### DynLex (benchmark.dl)

```
macro effect return value:
    replacement:
        @intrinsic("return", value)

macro effect set var to val:
    replacement:
        @intrinsic("store", var, val)

effect print msg as line:
    execute:
        @intrinsic("call", "libc", "printf", "%ld\n", msg)

expression left < right:
    get:
        return @intrinsic("less than", left, right)

macro expression left + right:
    replacement:
        @intrinsic("add", left, right)

macro section loop while condition:
    replacement:
        @intrinsic("loop while", condition)

set sum to 0
set i to 0
loop while i < 100000000:
    set sum to sum + i
    set i to i + 1
print sum as line
```

### C++ (benchmark.cpp)

```cpp
#include <cstdio>

int main() {
    long sum = 0;
    for (long i = 0; i < 100000000; i++) {
        sum = sum + i;
    }
    printf("%ld\n", sum);
    return 0;
}
```

### Python (benchmark.py)

```python
sum = 0
i = 0
while i < 100000000:
    sum = sum + i
    i = i + 1
print(sum)
```

## How to Run

```bash
# DynLex
./build/dynlex benchmark.dl -O3 -o bench_dynlex
time ./bench_dynlex

# C++
g++ -O3 benchmark.cpp -o bench_cpp
time ./bench_cpp

# Python
time python3 benchmark.py
```
